<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Nicklas Hafiz">
<title>IRT Voraussetzungen – IRT</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Keine Treffer",
    "search-matching-documents-text": "Treffer",
    "search-copy-link-title": "Link in die Suche kopieren",
    "search-hide-matches-text": "Zusätzliche Treffer verbergen",
    "search-more-match-text": "weitere Treffer in diesem Dokument",
    "search-more-matches-text": "weitere Treffer in diesem Dokument",
    "search-clear-button-title": "Zurücksetzen",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Abbrechen",
    "search-submit-button-title": "Abschicken",
    "search-label": "Suchen"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">IRT</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Suchen"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Navigation umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../slides/index.html"> 
<span class="menu-text">Folien</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../exercises/index.html"> 
<span class="menu-text">Übungen</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Auf dieser Seite</h2>
   
  <ul>
<li>
<a href="#%C3%BCbung-1" id="toc-übung-1" class="nav-link active" data-scroll-target="#%C3%BCbung-1">Übung 1</a>
  <ul class="collapse">
<li><a href="#gleichung" id="toc-gleichung" class="nav-link" data-scroll-target="#gleichung">Gleichung</a></li>
  <li><a href="#pl-funktion" id="toc-pl-funktion" class="nav-link" data-scroll-target="#pl-funktion">2PL Funktion</a></li>
  <li>
<a href="#simulieren-von-daten" id="toc-simulieren-von-daten" class="nav-link" data-scroll-target="#simulieren-von-daten">Simulieren von Daten</a>
  <ul class="collapse">
<li><a href="#items" id="toc-items" class="nav-link" data-scroll-target="#items">Items</a></li>
  <li><a href="#check-mit-tam" id="toc-check-mit-tam" class="nav-link" data-scroll-target="#check-mit-tam">Check mit <code>TAM</code></a></li>
  </ul>
</li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">IRT Voraussetzungen</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autor:in</div>
    <div class="quarto-title-meta-contents">
             <p>Nicklas Hafiz </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Veröffentlichungsdatum</div>
    <div class="quarto-title-meta-contents">
      <p class="date">26. September 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header><section id="übung-1" class="level1"><h1>Übung 1</h1>
<p>Wir schauen uns eine ganz simple Version an. Wer interessiert ist, und z.B. Daten für eine Poweranalyse simulieren möchte, findet <a href="">hier</a> Unterstützung. Installieren und/oder lade folgende Pakete für diese Übung:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Wenn noch nicht installiert:</span></span>
<span><span class="co"># install.packages("tidyverse")</span></span>
<span><span class="co"># install.packages("TAM")</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.edmeasurementsurveys.com/TAM/Tutorials/">TAM</a></span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="gleichung" class="level2"><h2 class="anchored" data-anchor-id="gleichung">Gleichung</h2>
<p>Zuerst müssen wir festlegen, was wir eigentlich simulieren wollen. Wir starten mit einem 2PL Modell. Wie sah die Gleichung dafür noch einmal aus?</p>
<p><span id="eq-2PL"><span class="math display">\[
P(X_{is} = 1|\theta_s,\beta_i,\alpha_i) = \frac{\exp(\alpha_i(\theta_s-\beta_i))}{1 + \exp(a_i (\theta_s - \beta_i))}
\tag{1}\]</span></span></p>
<ol type="1">
<li>Versuche noch einmal, alle Elemente von <a href="#eq-2PL" class="quarto-xref">Gleichung&nbsp;1</a> für dich selbst zu erklären.</li>
</ol>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lösung
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Wir versuchen zu schätzen wie hoch die Wahrscheinlichkeit ist, dass eine Person <span class="math inline">\(s\)</span> ein Item <span class="math inline">\(i\)</span> richtig (<span class="math inline">\(X_{is} = 1\)</span>) beantwortet. Dazu nutzen wir den Diskriminationsparameter <span class="math inline">\(\alpha_i\)</span> und den Schwierigkeitsparameter <span class="math inline">\(\beta_i\)</span> von Item <span class="math inline">\(i\)</span> und die Personenfähigkeit <span class="math inline">\(\theta_s\)</span> von Person <span class="math inline">\(s\)</span>.</p>
</div>
</div>
</div>
</section><section id="pl-funktion" class="level2"><h2 class="anchored" data-anchor-id="pl-funktion">2PL Funktion</h2>
<ol start="2" type="1">
<li>Jetzt beginnt der fun part: Schreibe eine <a href="">Funktion</a> genannt <code>calc_2pl</code> die <a href="#eq-2PL" class="quarto-xref">Gleichung&nbsp;1</a> in R Code umsetzt.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Der Aufbau der Funktion könnte so aussehen:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">calc_2pl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">alpha</span>, <span class="va">theta</span>, <span class="va">beta</span><span class="op">)</span><span class="op">{</span></span>
<span><span class="op">}</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Befülle sie nun mit <a href="#eq-2PL" class="quarto-xref">Gleichung&nbsp;1</a>. <code>alpha</code>, <code>theta</code> und <code>beta</code> sind hier also die Funktionsargumente (weil sie innerhalb der Klammern von <code>function()</code> stehen), und müssen beim späteren Aufruf der Funktion von der nutzenden Person mit Werten befüllt werden. Diese Werte können dann im Funktionskörper (zwischen <code><a href="https://rdrr.io/r/base/Paren.html">{}</a></code>) genutzt werden, um <a href="#eq-2PL" class="quarto-xref">Gleichung&nbsp;1</a> in R Code zu übersetzen.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lösung
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">calc_2pl</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">theta</span>, <span class="va">xi</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">a</span><span class="op">*</span><span class="op">(</span><span class="va">theta</span> <span class="op">-</span> <span class="va">xi</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">a</span><span class="op">*</span><span class="op">(</span><span class="va">theta</span> <span class="op">-</span> <span class="va">xi</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span> </span>
<span><span class="op">}</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>alpha</code>, <code>theta</code> und <code>beta</code> sind hier also die Funktionsargumente (weil sie innerhalb der Klammern von <code>function()</code> stehen), und müssen beim späteren Aufruf der Funktion von der nutzenden Person mit Werten befüllt werden. Im Funktionskörper (zwischen <code><a href="https://rdrr.io/r/base/Paren.html">{}</a></code>) werden sie genutzt, um <span class="math inline">\(p\)</span> anhand von <a href="#eq-2PL" class="quarto-xref">Gleichung&nbsp;1</a> zu berechnen.</p>
</div>
</div>
</div>
</section><section id="simulieren-von-daten" class="level2"><h2 class="anchored" data-anchor-id="simulieren-von-daten">Simulieren von Daten</h2>
<p>Jetzt geht’s los! Wir wollen nun eigene Daten simulieren. Das tolle ist: wir können so alle Aspekte selber festlegen, und daran untersuchen, wie sich das Variieren von bestimmten Parametern auf das Ergebnis auswirkt.</p>
<section id="items" class="level3"><h3 class="anchored" data-anchor-id="items">Items</h3>
<ol type="1">
<li>Zuerst die Items. Baue einen <code>data.frame</code> mit dem Namen <code>items</code>. Er soll 13 Zeilen und 4 Spalten haben und folgendes enthalten:</li>
</ol>
<ul>
<li>
<code>item_id</code>: Die ID des Items, von 1 bis 13.</li>
<li>
<code>alpha</code>: Die Diskriminationsparameter, liegen zwischen 0.5 und 1.5 in 13 gleich langen Schritten.</li>
<li>
<code>beta</code>: Die Schwierigkeitsparameter, liegen zwischen -3 und 3 jeweils im Abstand von 0.5.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Die Funktion <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> ist dein Freund. Mehr brauchst du nicht, um die Zahlenreihen zu erzeugen. Schaue dir die Dokumentation an.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lösung
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    item_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">13</span>, </span>
<span>    b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span>, by <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, </span>
<span>    a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.5</span>, length.out <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>, </span>
<span>    c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">13</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Das sind also die Itemparameter, die wir in unsere Simulation packen.</p>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Jetzt können wir die Personen simulieren. Unser Ziel ist also ein <code>data.frame</code>, der <span class="math inline">\(\theta\)</span> Werte für die untersuchten Personen enthält. Wir simulieren 100000 Personen, der <code>data.frame</code> sollte also 100000 Zeilen haben. Außerdem benötigen wir zwei Spalten:</li>
</ol>
<ul>
<li>
<code>ID</code>: Die ID der Person, von 1 bis 100000.</li>
<li>
<code>theta</code>: Die Fähigkeit der Person, die wir simulieren. Wir nehmen an, dass die Fähigkeit normalverteilt ist, mit einem Mittelwert von 0 und einer Standardabweichung von 1.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Wir können zufällige Daten aus einer Normalverteilung mit Hilfe der Funktion <code><a href="https://rdrr.io/r/stats/Normal.html">rnorm()</a></code> ziehen.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lösung
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">666</span><span class="op">)</span> </span>
<span><span class="co">## Ich setzte hier einen Seed, damit meine zufällig erzeugten Werte replizierbar bleiben.</span></span>
<span><span class="co">## Wenn du den Seed in deinem Skript auf die gleiche Zahl setzt, bekommst du genau die gleichen Zufallswerte und kannst besser vergleichen. </span></span>
<span></span>
<span></span>
<span><span class="va">subjects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    sub_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">100000</span>,</span>
<span>    theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100000</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Perfekt! Jetzt können wir die Itemantworten simulieren. Dazu sind noch ein paar kleine Schritte nötig:</p>
<ol start="3" type="1">
<li>Merge die beiden <code>data.frames</code> <code>subjects</code> und <code>items</code> zu einem neuen <code>data.frame</code> <code>sim_dat</code> zusammen. Und zwar so, dass wir <span class="math inline">\(1000 * 13\)</span> Zeilen bekommen, also jede Person jedes der 13 Items zugeordnet wird (bisher noch ohne Antwort der Person, nur mit den Itemkennwerten. Das erleichtert uns im nächsten Schritt, die Antworten der Personen zu simulieren).</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Nutze die Funktion <code><a href="https://rdrr.io/r/base/merge.html">merge()</a></code> ohne irgendwelche weiteren Argumente.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lösung
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">subjects</span>, <span class="va">items</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Wir schauen mal, ob das hinkommt:</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1300000 obs. of  6 variables:
 $ sub_id : int  1 2 3 4 5 6 7 8 9 10 ...
 $ theta  : num  0.753 2.014 -0.355 2.028 -2.217 ...
 $ item_id: int  1 1 1 1 1 1 1 1 1 1 ...
 $ b      : num  -3 -3 -3 -3 -3 -3 -3 -3 -3 -3 ...
 $ a      : num  0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 ...
 $ c      : num  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
</div>
</div>
<p>Unser finaler <code>data.frame</code> hat 1300000 Zeilen, wie verlangt. Lasst uns auch noch einmal schauen, ob eine zufällige Person alle Items beantwortet hat:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sim_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">sub_id</span> <span class="op">==</span> <span class="fl">420</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">item_id</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10 11 12 13</code></pre>
</div>
</div>
<p>Das sieht gut aus!</p>
</div>
</div>
</div>
<ol start="4" type="1">
<li>Jetzt simulieren wir aus diesem Vorbereiteten <code>data.frame</code> die Antworten der Personen, abhängig von ihren Fähigkeiten <span class="math inline">\(\theta\)</span> (jede Person hat hier einen zufälligen Wert aus einer Normalverteilung mit <span class="math inline">\(\mu = 1\)</span> und <span class="math inline">\(\sigma = 1\)</span> bekommen) und den Itemparametern <span class="math inline">\(\alpha\)</span> und <span class="math inline">\(\beta\)</span> (die hatten wir einfach als Sequenz festgelegt). Lege eine neue Spalte <code>p</code> in <code>sim_dat</code> an, die für jede Person die Wahrscheinlichkeit enthält, dass sie das jeweilige Item richtig beantwortet. Dafür brauchen wir jetzt unsere Funktion <code>calc_2pl</code>, die wir am Anfang definiert haben! Diese nimmt aus jeder Zeile den <code>theta</code>, <code>alpha</code> und <code>beta</code> Wert als input, und berechnet daraus die Wahrscheinlichkeit, dass die Person das Item richtig beantwortet.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Supereinfach geht das ganze mit der <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> Funktion aus dem <code>tidyverse</code>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lösung
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="va">sim_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fu">calc_2pl</span><span class="op">(</span><span class="va">a</span>, <span class="va">theta</span>, <span class="va">b</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Mal nachschauen:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  sub_id      theta item_id  b   a c         p
1      1  0.7533110       1 -3 0.5 0 0.8672265
2      2  2.0143547       1 -3 0.5 0 0.9246434
3      3 -0.3551345       1 -3 0.5 0 0.7895862
4      4  2.0281678       1 -3 0.5 0 0.9251233
5      5 -2.2168745       1 -3 0.5 0 0.5966588
6      6  0.7583962       1 -3 0.5 0 0.8675190</code></pre>
</div>
</div>
<p>Auf den ersten Blick sieht das schonmal gut aus. Personen mit niedrigerem <span class="math inline">\(\theta\)</span> Wert haben auch eine geringere Wahrscheinlichkeit, das Item richtig zu beantworten (vgl. z.B. Zeile 2 und 3).</p>
</div>
</div>
</div>
<ol start="5" type="1">
<li>Jetzt sind wir auch schon fast am Ende. Wir müssen lediglich aus den Wahrscheinlichkeiten die tatsächlichen Antworten der Personen simulieren. Nutze die Berechneten Antwortwahrscheinlichkeiten <code>p</code>, um für jede Person und jedes Item einen Wert aus einer <a href="https://de.wikipedia.org/wiki/Bernoulli-Verteilung">Bernoulliverteilung</a> zu ziehen.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Eine Bernoulliverteilung ist eine Binomialverteilung mit nur einem Versuch. Wir können daher die Funktion <code><a href="https://rdrr.io/r/stats/Binomial.html">rbinom()</a></code> nutzen, und das <code>size</code>-Argument auf 1 setzen.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lösung
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="va">sim_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>answer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  sub_id      theta item_id  b   a c         p answer
1      1  0.7533110       1 -3 0.5 0 0.8672265      1
2      2  2.0143547       1 -3 0.5 0 0.9246434      1
3      3 -0.3551345       1 -3 0.5 0 0.7895862      0
4      4  2.0281678       1 -3 0.5 0 0.9251233      1
5      5 -2.2168745       1 -3 0.5 0 0.5966588      1
6      6  0.7583962       1 -3 0.5 0 0.8675190      1</code></pre>
</div>
</div>
<p>Auch das sieht erst einmal plausibel aus! Toll!</p>
</div>
</div>
</div>
</section><section id="check-mit-tam" class="level3"><h3 class="anchored" data-anchor-id="check-mit-tam">Check mit <code>TAM</code>
</h3>
<p>Jetzt wollen wir natürlich noch schauen, ob das Ganze so funktioniert hat, wie wir uns das vorgestellt haben. Wir wollen das <code>TAM</code> Paket, um ein 2PL Modell auf die Itemantworten zu fitten. Wenn alles geklappt hat, sollten wir in etwa unsere Itemparameter wiedererkennen.</p>
<ol type="1">
<li>Zuerst müssen wir unsere Daten dafür noch ein bisschen aufbereiten, sprich ins Wide-Format bringen. Probiere das also mal aus!</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Ich nutze dafür immer deutlich lieber die <code>tidyverse</code> Funktion <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> als die base-R Funtkion <code><a href="https://rdrr.io/r/stats/reshape.html">reshape()</a></code>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lösung
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sim_dat_wide</span> <span class="op">&lt;-</span> <span class="va">sim_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">item_id</span>, <span class="va">sub_id</span>, <span class="va">answer</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">item_id</span>, values_from <span class="op">=</span> <span class="va">answer</span>, id_cols <span class="op">=</span> <span class="va">sub_id</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sim_dat_wide</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  sub_id   `1`   `2`   `3`   `4`   `5`   `6`   `7`   `8`   `9`  `10`  `11`  `12`
   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
1      1     1     1     1     1     1     0     1     0     1     1     0     0
2      2     1     1     1     1     1     1     1     1     1     1     1     0
3      3     0     1     1     1     0     0     0     0     0     1     0     0
4      4     1     1     1     1     1     1     1     1     0     0     0     0
5      5     1     1     0     1     0     0     0     0     0     0     0     0
6      6     1     1     0     1     1     1     0     0     0     0     0     0
# ℹ 1 more variable: `13` &lt;int&gt;</code></pre>
</div>
</div>
<p>Die Spaltennamen sind jetzt unsere Item-Nummern. Pro Zeile finden sich die Antworten der Personen, entweder hat sie das entsprechende Item richtig (<code>1</code>) oder falsch (<code>0</code>) beantwortet.</p>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Jetzt können wir das Modell fitten. Nutze dafür wie angekündigt das <code>TAM</code> Paket, und entferne noch die Spalte <code>sub_id</code>, wir geben nur die Itemantworten in die Funktion. Speichere den Funktionsoutput in dem Object <code>sim_dat_2PL</code>.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tipp
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Wir brauchen die Funktion <code><a href="https://rdrr.io/pkg/TAM/man/tam.mml.html">tam.mml.2pl()</a></code>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sim_dat_2PL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/TAM/man/tam.mml.html">tam.mml.2pl</a></span><span class="op">(</span><span class="va">sim_dat_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">sub_id</span><span class="op">)</span>, irtmodel <span class="op">=</span> <span class="st">"2PL"</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>....................................................
Processing Data      2024-09-26 10:20:16.797047 
    * Response Data: 100000 Persons and  13 Items 
    * Numerical integration with 21 nodes
    * Created Design Matrices   ( 2024-09-26 10:20:16.981059 )
    * Calculated Sufficient Statistics   ( 2024-09-26 10:20:17.244264 )
....................................................
Iteration 1     2024-09-26 10:20:17.280188
E Step
M Step Intercepts   |----
M Step Slopes       |---
  Deviance = 1267150.8426
  Maximum item intercept parameter change: 0.419556
  Maximum item slope parameter change: 0.209449
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 2     2024-09-26 10:20:17.508865
E Step
M Step Intercepts   |---
M Step Slopes       |---
  Deviance = 1256572.3453 | Absolute change: 10578.5 | Relative change: 0.00841853
  Maximum item intercept parameter change: 0.142116
  Maximum item slope parameter change: 0.13129
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 3     2024-09-26 10:20:17.747927
E Step
M Step Intercepts   |---
M Step Slopes       |---
  Deviance = 1255075.8194 | Absolute change: 1496.526 | Relative change: 0.00119238
  Maximum item intercept parameter change: 0.085173
  Maximum item slope parameter change: 0.070548
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 4     2024-09-26 10:20:17.983675
E Step
M Step Intercepts   |---
M Step Slopes       |---
  Deviance = 1254560.5132 | Absolute change: 515.3062 | Relative change: 0.00041075
  Maximum item intercept parameter change: 0.064561
  Maximum item slope parameter change: 0.041601
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 5     2024-09-26 10:20:18.104495
E Step
M Step Intercepts   |---
M Step Slopes       |---
  Deviance = 1254359.2843 | Absolute change: 201.2289 | Relative change: 0.00016042
  Maximum item intercept parameter change: 0.050987
  Maximum item slope parameter change: 0.030886
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 6     2024-09-26 10:20:18.218689
E Step
M Step Intercepts   |---
M Step Slopes       |---
  Deviance = 1254269.9949 | Absolute change: 89.2894 | Relative change: 7.119e-05
  Maximum item intercept parameter change: 0.04019
  Maximum item slope parameter change: 0.023359
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 7     2024-09-26 10:20:18.349454
E Step
M Step Intercepts   |---
M Step Slopes       |---
  Deviance = 1254226.1047 | Absolute change: 43.8902 | Relative change: 3.499e-05
  Maximum item intercept parameter change: 0.031482
  Maximum item slope parameter change: 0.017898
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 8     2024-09-26 10:20:18.579544
E Step
M Step Intercepts   |---
M Step Slopes       |--
  Deviance = 1254203.2462 | Absolute change: 22.8585 | Relative change: 1.823e-05
  Maximum item intercept parameter change: 0.02456
  Maximum item slope parameter change: 0.013847
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 9     2024-09-26 10:20:18.691134
E Step
M Step Intercepts   |---
M Step Slopes       |--
  Deviance = 1254191.0072 | Absolute change: 12.239 | Relative change: 9.76e-06
  Maximum item intercept parameter change: 0.019126
  Maximum item slope parameter change: 0.01079
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 10     2024-09-26 10:20:18.802927
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254184.3636 | Absolute change: 6.6436 | Relative change: 5.3e-06
  Maximum item intercept parameter change: 0.014893
  Maximum item slope parameter change: 0.008455
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 11     2024-09-26 10:20:19.031997
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254180.7248 | Absolute change: 3.6388 | Relative change: 2.9e-06
  Maximum item intercept parameter change: 0.011608
  Maximum item slope parameter change: 0.006653
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 12     2024-09-26 10:20:19.136445
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254178.7154 | Absolute change: 2.0093 | Relative change: 1.6e-06
  Maximum item intercept parameter change: 0.009062
  Maximum item slope parameter change: 0.005253
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 13     2024-09-26 10:20:19.252339
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254177.5963 | Absolute change: 1.1192 | Relative change: 8.9e-07
  Maximum item intercept parameter change: 0.007088
  Maximum item slope parameter change: 0.004157
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 14     2024-09-26 10:20:19.383681
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254176.967 | Absolute change: 0.6293 | Relative change: 5e-07
  Maximum item intercept parameter change: 0.005555
  Maximum item slope parameter change: 0.003297
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 15     2024-09-26 10:20:19.579597
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254176.6097 | Absolute change: 0.3573 | Relative change: 2.8e-07
  Maximum item intercept parameter change: 0.004363
  Maximum item slope parameter change: 0.002619
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 16     2024-09-26 10:20:19.691231
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254176.4047 | Absolute change: 0.205 | Relative change: 1.6e-07
  Maximum item intercept parameter change: 0.003433
  Maximum item slope parameter change: 0.002083
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 17     2024-09-26 10:20:19.802867
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254176.286 | Absolute change: 0.1188 | Relative change: 9e-08
  Maximum item intercept parameter change: 0.002706
  Maximum item slope parameter change: 0.001658
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 18     2024-09-26 10:20:19.915346
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254176.2165 | Absolute change: 0.0695 | Relative change: 6e-08
  Maximum item intercept parameter change: 0.002137
  Maximum item slope parameter change: 0.001321
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 19     2024-09-26 10:20:20.042799
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254176.1755 | Absolute change: 0.041 | Relative change: 3e-08
  Maximum item intercept parameter change: 0.00169
  Maximum item slope parameter change: 0.001053
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 20     2024-09-26 10:20:20.24803
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254176.1511 | Absolute change: 0.0244 | Relative change: 2e-08
  Maximum item intercept parameter change: 0.001338
  Maximum item slope parameter change: 0.00084
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 21     2024-09-26 10:20:20.366207
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254176.1364 | Absolute change: 0.0146 | Relative change: 1e-08
  Maximum item intercept parameter change: 0.001061
  Maximum item slope parameter change: 0.00067
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 22     2024-09-26 10:20:20.477216
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254176.1276 | Absolute change: 0.0088 | Relative change: 1e-08
  Maximum item intercept parameter change: 0.000842
  Maximum item slope parameter change: 0.000535
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 23     2024-09-26 10:20:20.589439
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254176.1222 | Absolute change: 0.0054 | Relative change: 0
  Maximum item intercept parameter change: 0.000669
  Maximum item slope parameter change: 0.000427
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 24     2024-09-26 10:20:20.719402
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254176.1189 | Absolute change: 0.0033 | Relative change: 0
  Maximum item intercept parameter change: 0.000532
  Maximum item slope parameter change: 0.000341
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 25     2024-09-26 10:20:20.92224
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254176.1169 | Absolute change: 0.002 | Relative change: 0
  Maximum item intercept parameter change: 0.000423
  Maximum item slope parameter change: 0.000272
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 26     2024-09-26 10:20:21.03384
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254176.1156 | Absolute change: 0.0012 | Relative change: 0
  Maximum item intercept parameter change: 0.000337
  Maximum item slope parameter change: 0.000218
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 27     2024-09-26 10:20:21.145532
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254176.1149 | Absolute change: 8e-04 | Relative change: 0
  Maximum item intercept parameter change: 0.000268
  Maximum item slope parameter change: 0.000174
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 28     2024-09-26 10:20:21.330443
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254176.1144 | Absolute change: 5e-04 | Relative change: 0
  Maximum item intercept parameter change: 0.000214
  Maximum item slope parameter change: 0.000139
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 29     2024-09-26 10:20:21.451793
E Step
M Step Intercepts   |--
M Step Slopes       |--
  Deviance = 1254176.1141 | Absolute change: 3e-04 | Relative change: 0
  Maximum item intercept parameter change: 0.00017
  Maximum item slope parameter change: 0.000111
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 30     2024-09-26 10:20:21.56306
E Step
M Step Intercepts   |--
M Step Slopes       |-
  Deviance = 1254176.1139 | Absolute change: 2e-04 | Relative change: 0
  Maximum item intercept parameter change: 0.000136
  Maximum item slope parameter change: 8.9e-05
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 31     2024-09-26 10:20:21.675165
E Step
M Step Intercepts   |--
M Step Slopes       |-
  Deviance = 1254176.1138 | Absolute change: 1e-04 | Relative change: 0
  Maximum item intercept parameter change: 0.000108
  Maximum item slope parameter change: 7.1e-05
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Iteration 32     2024-09-26 10:20:21.807106
E Step
M Step Intercepts   |-
M Step Slopes       |-
  Deviance = 1254176.1137 | Absolute change: 1e-04 | Relative change: 0
  Maximum item intercept parameter change: 8.6e-05
  Maximum item slope parameter change: 5.7e-05
  Maximum regression parameter change: 0
  Maximum variance parameter change: 0
....................................................
Item Parameters
   xsi.index xsi.label     est
1          1         1 -1.5085
2          2         2 -1.4816
3          3         3 -1.3370
4          4         4 -1.1347
5          5         5 -0.8444
6          6         6 -0.4600
7          7         7 -0.0038
8          8         8  0.5308
9          9         9  1.1642
10        10        10  1.8783
11        11        11  2.6740
12        12        12  3.4901
13        13        13  4.4630
...................................
Regression Coefficients
     [,1]
[1,]    0

Variance:
     [,1]
[1,]    1


EAP Reliability:
[1] 0.626

-----------------------------
Start:  2024-09-26 10:20:16.793764
End:  2024-09-26 10:20:22.263 
Time difference of 5.469237 secs</code></pre>
</div>
</div>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Schau dir die Itemparameter an, die das Modell geschätzt hat. Sie finden sich unter <code>sim_dat_2PL$item_irt[, c("alpha", "beta")]</code>. Vergleiche mit den ursprünglichen Itemparametern, die wir in <code>items</code> festgelegt haben. Was fällt dir auf?</li>
</ol>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lösung
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">items_2pl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">sim_dat_2PL</span><span class="op">$</span><span class="va">item_irt</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"beta"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">2</span>, <span class="va">round</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">item_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">items_2pl</span>, <span class="va">items</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">item_comparison</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   alpha  beta         a    b
1   0.52 -2.92 0.5000000 -3.0
2   0.59 -2.53 0.5833333 -2.5
3   0.66 -2.04 0.6666667 -2.0
4   0.75 -1.52 0.7500000 -1.5
5   0.84 -1.01 0.8333333 -1.0
6   0.92 -0.50 0.9166667 -0.5
7   1.00  0.00 1.0000000  0.0
8   1.09  0.49 1.0833333  0.5
9   1.17  1.00 1.1666667  1.0
10  1.24  1.52 1.2500000  1.5
11  1.35  1.97 1.3333333  2.0
12  1.38  2.52 1.4166667  2.5
13  1.47  3.03 1.5000000  3.0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stefanom.io/latex2exp/">latex2exp</a></span><span class="op">)</span> <span class="co"># Erlaubt es, Latex Syntax in ggplot zu nutzen</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">item_comparison</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">b</span>, y <span class="op">=</span> <span class="va">beta</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span>, colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co">## Ein anderes Theme festlegen</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://www.stefanom.io/latex2exp/reference/TeX.html">TeX</a></span><span class="op">(</span><span class="st">"\\beta"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co">## Latex Syntax für die Achsenbeschriftung nutzen</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://www.stefanom.io/latex2exp/reference/TeX.html">TeX</a></span><span class="op">(</span><span class="st">"\\hat{\\beta}"</span><span class="op">)</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Vorraussetzungen_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">item_comparison</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">a</span>, y <span class="op">=</span> <span class="va">alpha</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span>, colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://www.stefanom.io/latex2exp/reference/TeX.html">TeX</a></span><span class="op">(</span><span class="st">"\\alpha"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://www.stefanom.io/latex2exp/reference/TeX.html">TeX</a></span><span class="op">(</span><span class="st">"\\hat{\\alpha}"</span><span class="op">)</span><span class="op">)</span></span></code><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Vorraussetzungen_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Das sieht super aus, die Werte stimmen gut überein. Dadurch, dass wir so viele Personen simuliert haben, sehen wir also, dass unsere Simulation gut funktioniert. Wir können das Gerüst dieses Simplen Modells jetzt nutzen, um uns noch spannendere Fragestellungen anzuschauen.</p>
</div>
</div>
</div>


</section></section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopiert");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopiert");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/nickhaf\.github\.io\/IRT_workshop\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>