---
title: "Einführung in R"
author: "Nicklas Hafiz"

title-slide-attributes:
  data-background-image: ./images/r_desktop.jpg
  data-background-size: cover
  data-background-opacity: "0"
format: letterbox-revealjs
---


## Überblick

1. Arbeiten mit R und RStudio
2. Grundlegende Operationen in R: Daten laden, Pakete installieren ...
3. Datenmanipulation und Transformation in R

:::{.callout-note}
## Ziel
Am Ende der Session solltet ihr mit den Grundlagen in R vertraut sein, sodass ihr den Rest des Workshops in R bestreiten könnt.   
:::


## {background-image="images/keyboard.jpg" background-size="1150px"}

::: {.absolute left="2.5%" top="2.5%" style="padding: 0.5em 0.5em; background-color: rgba(255, 255, 255, 0); backdrop-filter: blur(0px); box-shadow: 0 0 0rem 0 rgba(255, 255, 255, 0);"}

Arbeiten mit R \
und RStudio

:::

## RStudio Interface

Beim ersten Öffnen wird RStudio in etwa so aussehen:

![](./images/RStudio_window.PNG){fig-align="center"}

## RStudio Interface
Das Fenster hat 4 Bereiche:

![](./images/window_commented.PNG){fig-align="center"}

## 1) Script Pane
Editieren von Skripten (Datein, in denen Code gespeichert wird) und ausführen von Code (`crtl + enter` (Windows) oder `command + return` (macOS).

```{r}
#| code-link: true
# Our first line of code:
print("Hello World!")
```

:::{.callout-tip}
Übrigens: Codezeilen, die mit einem `#` beginnen, sind auskommentiert und werden nicht ausgewertet. 
:::

## 2) Console

Hier erscheint der Output aus unseren Skripten. Wir können auch direkt in der Konsole arbeiten und Befehle mit `enter` ausführen:

```{r}
10 + 5
```

:::{.callout-important}
Hier geschriebener Code wird nicht gespeichert. Nutze die Konsole also, um Dinge auszuprobieren, schreibe aber alles Wichtige in Skripte. 
:::

## 3) Workspace 
Im [Environment]{.highlight}-Tab erhalten wir einen Überblick über die Objekte, die derzeit in unserer R-Sitzung geladen sind.    
\
Wir können auch den Befehlsverlauf einsehen und einige weitere Dinge, die wir jetzt nicht benötigen.

## 4) Plots, Datein, Hilfe ...

Plots, die wir in einer R-Sitzung erstellen, werden im [Plot]{.highlight}-Tab ausgegeben.   

Beim Aufrufen der Hilfefunktion öffnet sich die Dokumentation im [Hilfe]{.highlight}-Tab.  

:::{.callout-important}

## Hilfe in R
Die Dokumentation kann mit `?funktionsname` aufgerufen werden. Das ist eines der wichtigsten Werkzeuge bei der Arbeit in R. 

:::

Der [Dateien]{.highlight}-Tab ermöglicht es uns, die Dateien in unserem Arbeitsverzeichnis zu verwalten.





## {background-image="images/coder.jpg" background-size="1150px"}

::: {.absolute left="5%" bottom="5%" style="color:#F8F8F8;"}

Los Geht's!
:::



## {background-image="images/setup.jpg" background-size="1150px"}

::: {.absolute left="5%" top="5%" style="color:#F8F8F8;"}

Basic Setup
:::

## RStudio Projekte
Hilft ungemein beim Organisieren von Dateien und Code!

:::{.callout-warning}
## Übung
Erstelle einen neuen Ordner (falls noch nicht getan) für diesen Workshop, und lege darin ein RStudio Projekt an (`File - New Project`).
:::

## Skripte

Hier kommt der Code rein!

:::{.callout-warning}
## Übung
Erstelle einen neuen Unterordner und lege darin ein R-Skript and (`File - New File - R Script`). In diesen kommen dann die Übungsaufgaben und Notizen aus dem Workshop. Leg am besten für jedes Thema ein eigenes Skript an, damit sie übersichtlich bleiben.
:::


## Pakete

:::: {.columns} 
::: {.column width="50%"}
Pakete sind Erweiterungen zum `base R` und funktionieren ein bisschen wie Apps im Playstore:

- ![](./images/playstore.png){width="19"} Einmalig installieren: 

```{r}  
#| eval: false
install.packages("packagename")
```

- ![](./images/app.png){width="19"} Bei jeder Nutzung in die R-Session laden:

```{r}  
#| eval: false
library(packagename)
```


:::

::: {.column width="50%"}

![](./images/pakete.jpg){.image-right}
::: 
:::: 

## [tidyverse](https://www.tidyverse.org/) {style="text-align: right;"}
:::: {.columns} 

::: {.column width="40%"}
![](./images/tidyverse_logo.png)
:::
::: {.column width="60%"}
Verbreitete Paketsammlung in R für so ziemlich jede Stufe in der Datenauswertung. Der meiste Code wird wahrscheinlich aus einer Mischung aus `base R` und `tidyverse` bestehen. 
:::
::::
## `tidyverse`: Pipe Operator

`%>%`


```{r}
sum(seq(from = 1, to = mean(c(45:100), na.rm = TRUE), by = 0.1))
```

wird zu:

```{r}
library(tidyverse)

c(45:100) %>%
  mean(na.rm = TRUE) %>%
  seq(from = 1, to = ., by = 0.1) %>%
  sum
```



## {background-image="images/data.jpg" background-size="1200px"}

::: {.absolute right="5%" top="5%" style="font-size:2em; padding: 0.5em 0.5em; background-color: rgba(255, 255, 255 .7); backdrop-filter: blur(5px); box-shadow: 0 0 1rem 0 rgba(255, 255, 255 .5); border-radius: 5px;"}

Daten und Pfade
:::

## Einlesen von Daten
```{css}
#| echo: false

.reveal table {
  font-size: 30px;
}

```

| Data type             | Import                    | Export                    |
|-----------------------|---------------------------|---------------------------|
| R objects (.Rdata, .rda) | `load()`                  | `save()`                  |
| single R object (.rds) | `readRDS()`               | `saveRDS()`               |
| text-files (.txt)     | `read.table()`            | `write.table()`           |
| .csv-files (.csv)     | `read.csv()`              | `write.csv()`             |
| Excel-files (.xlsx)   | `readxl::read_excel()`    | `writexl::write_xlsx()`   |
| SPSS-files (.sav)     | `haven::read_sav()`       | `haven::write_sav()`      |
| SAS-files (.sas)      | `haven::read_sas()`       | `haven::write_sas()`      |
| Stata-files (.stata)  | `haven::read_dta()`       | `haven::write_dta()`      |

: {.striped}

## {background-color="#FFFFFF"}
![](./images/here.png){fig-align="center"}


## Exkurs: `here`-Paket

[`here`](https://here.r-lib.org/) ist ein Paket zum Erstellen von Dateipfaden. Dadurch können Probleme mit relativen und absoluten Pfaden vermieden werden. 

"C:\Users\hafiznij\Documents\GitHub\IRT_workshop\raw_data\athletes.rds" wird zu `here::here("raw_data", "athletes.rds")`. 

Also:
```{r}
# install.packages("here")
athletes <- readRDS(here::here("raw_data", "athletes.rds"))
```

## 

:::{.callout-note}
## Übung
Bitte bearbeite die [Übung zum Einlesen von Daten].
:::

# Datenmanipulation und Transformation

# Einen Überblick bekommen: `View()`
https://unsplash.com/de/fotos/mann-steht-auf-grossem-schachbrett-mit-brustfiguren-im-park-UDfmSK4AS3E
- Datensatz in neuem Fenster:
```{r}
#| eval: false
View(athletes)
```

## Einen Überblick bekommen: `str()`
- Struktur der Daten:
```{r}
str(athletes)
```

## Einen Überblick bekommen: `head()`
- Erste Zeilen:

```{r}
head(athletes)
```

## 

:::{.callout-note}
## Übung
Wie viele Zeilen und Spalten hat der in der letzten Übung eingelesene Datensatz `characters`? 
:::


:::{.callout-note}
## Übung
Aus welcher Show stammen die ersten Charactere im Datensatz? 
:::

# Subsetting

"zeilen zuerst, spalten später"

[Zeile, Spalte]

## Subsetting

```{r}
# Extract the columns by name:
athletes[c(1,4), c("Year", "Sport")]
```

## Konditionales Subsetting

```{r}
athletes[athletes$Team == "Germany", ]
```

- Alle Zeilen, in denen `Team` gleich `Germany` ist.
- Was passiert hier genau?
- Wir erzeugen einen Boolean Vektor (besteht aus TRUE und FALSE), der anzeigt, welche Zeilen ausgewählt werden sollen:

```{r}
athletes$Team == "Germany"
```

## Konditionales Subsettting

```{r}
athletes_3 <- athletes[(athletes$Sport == "Judo") & (athletes$Weight > 100 | athletes$Weight < 50), ]
head(athletes_3)
```

## Subsetting: Tidyverse
```{r, output.lines=4}
library(tidyverse)

athletes %>%
  filter(Sport == "Judo", (Weight > 100 | Weight < 50)) %>%
  head
```

```{r, output.lines=4}
athletes %>%
  select(Year, Sport) %>%
  head
```


## Übung
:::{.callout-note}
## Übung
Bitte bearbeite die [Übung zum Subsetting].
:::

# Fehlende Werte
- `NA

```{r}
is.na(athletes$Weight)
```


```{r}
athletes[(athletes$Sport == "Judo") & (athletes$Weight > 100 | athletes$Weight < 50) & !is.na(athletes$Weight), ]
```

```{r}
athletes_na <- athletes[!is.na(athletes$Weight), ]
head(athletes_na)
```

```{r}
library(tidyverse)

athletes_na <- athletes %>%
  drop_na(Weight)
head(athletes_na)
```


# Reshaping


## Wide- und Long-Format
```{r}
inhabitants_wide <- data.frame(
  country = c("China", "India", "USA"),
  inhabitants_2021 = c(1425893465 , 1407563842, NA),
  inhabitants_2022 = c(1425857720, 1420939232, 338903174)
)

head(inhabitants_wide)
```

```{r}
#| echo: false

inhabitants_long <- inhabitants_wide %>%
  mutate(inhabitants_2021 = c(9597000, 3287000, 9834000)) %>%
  rename(area = inhabitants_2021) %>%
  pivot_longer(!country, names_to = "variable", values_to = "value") %>%
  data.frame()

head(inhabitants_long)
```


## Von Wide zu Long

```{r}
inhabitants_long_2 <- inhabitants_wide %>%
  pivot_longer(
    ## Spalten die gereshaped werden sollen
    cols = c("inhabitants_2022", "inhabitants_2021"),
    ## Neue Spalte, in der die bisherigen Spaltennamen gespeichert werden
    names_to = "year",
    ## Neue Spalte, in der die bisherigen Werte gespeichert werden
    values_to = "inhabitants"
  )

head(inhabitants_long)
```

## Von Long zu Wide

```{r}
inhabitants_wide_2 <- inhabitants_long %>%
  pivot_wider(
    id_cols = "country",
    names_from = "variable",
    values_from = "value"
  )

head(inhabitants_wide_2)
```

## Übung
:::{.callout-note}
## Übung
Bitte bearbeite die [Übung zum Resahping].
:::


# Merging

## 
```{r}
world_coordinates <- readRDS(file = here::here("raw_data", "world_coordinates.rds"))
```

```{r}
medal_counts <- athletes %>%
  filter(Medal == "Gold") %>%
  group_by(Region) %>%
  count(Medal) 

medal_counts
```


```{r}
medal_countries <- merge(
  x = medal_counts,
  y = world_coordinates,
  by.x = "Region",
  by.y = "region",
  all.x = FALSE,
  all.y = TRUE
)

head(medal_countries)
```


```{r}
medal_countries <- world_coordinates %>%
  left_join(medal_counts, join_by(region == Region))
head(medal_countries)
```

## Übung
:::{.callout-note}
## Übung
Bitte bearbeite die [Übung zum Merging].
:::


# Funktionen

## Basics

function_name <- function(argument_1, argument_2, ...){
  do some operations
  
  return(result)
}


## Motivation
- Alles was etwas in R **tut** ist eine Funktion. 
- Superhilfreich, sich eigene Funktionen zu schreiben, weil das eine Menge Code-Duplikationen vermeidet (und die sind schlecht). 

## Beispiel
```{r}
sum_num <- function(x, y, z = 0){
  result <- x + y + z
  return(result)
}

sum_num(x = 1, y = 1, z = 2)
```


# Aufs folgende evtl. zurückkommen, falls es relevant wird. 
# Loops

# Plots

# Image links
- https://unsplash.com/de/fotos/schwarzer-flachbildschirm-gA396xahf-Q
- Foto von <a href="https://unsplash.com/de/@adigold1?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Adi Goldstein</a> auf <a href="https://unsplash.com/de/fotos/graustufenfotografie-eines-mannes-im-gestreiften-hemd-rgkKFn5Ysb0?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Unsplash</a>
- Icons from [icons8.de](https://icons8.de).
- Foto von <a href="https://unsplash.com/de/@elnazasadi?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">elnaz asadi</a> auf <a href="https://unsplash.com/de/fotos/ein-mehrfarbiges-muster-aus-sechseckigen-formen-Ej50vyvxJ94?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Unsplash</a>
- Foto von <a href="https://unsplash.com/de/@kommumikation?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Mika Baumeister</a> auf <a href="https://unsplash.com/de/fotos/weisses-druckpapier-mit-zahlen-Wpnoqo2plFA?utm_content=creditCopyText&utm_medium=referral&utm_source=unsplash">Unsplash</a>
- https://upload.wikimedia.org/wikipedia/commons/f/ff/Tidyverse_hex_logo.png
- https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/here.png
  
